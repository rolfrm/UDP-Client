<html>
    <link rel="STYLESHEET" type="text/css" href="./style.css"/>
    <!-- <script src="https://fb.me/react-0.14.0.min.js"></script>
    <script src="https://fb.me/react-dom-0.14.0.min.js"></script>-->
  <script type="text/javascript">

var get_thing = function(request, callback){
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.overrideMimeType('application/json');
    xmlhttp.onreadystatechange = function(){
	if(xmlhttp.readyState == XMLHttpRequest.DONE){
	    if(xmlhttp.status == 200){
		callback(JSON.parse(xmlhttp.responseText));
	    }
	}
    }
    xmlhttp.open("GET", request, true);
    xmlhttp.send();
}

var main_viewmodel = {
    selected_share: [],
    shares: []
};

var test_share = {
    path: "testdir1",
    user: "test@0.0.0.0:a",
    content : []
};

var test_share2 = {
    path: "testdir2",
    user: "test@0.0.0.0:a",
    content : []
};

main_viewmodel.selected_share = test_share;
main_viewmodel.shares = [test_share, test_share2];

var divdown = function(item){
    main_viewmodel.selected_share = main_viewmodel.shares[item.tabIndex];
    update_shares();
    update_content();
}

var update_shares = function(){
    var details_div = document.getElementById("shares_list")
    var shares = main_viewmodel.shares;
    var shares_len = shares.length;
    var items = "";
    for(var i = 0; i < shares_len; i++){
	var item = shares[i].path;
	if(shares[i] == main_viewmodel.selected_share)
	    item = "<div id=\"selected\" >" + item + "</div>";
	else
	    item = "<div id=\"divitem\" onmousedown=\"divdown(this)\" tabIndex=\"" + i + "\">" + item + "</div>";
	
	items += item;
    }
    details_div.innerHTML = items;
}

var update_content = function(){
    var cb = function(item){
	var details = document.getElementById("share_details");
	var len = item.length;
	var newcontent = "";
	for(var i = 0; i < len; i++)
	    newcontent += "<p>" + item[i].path+ " " + item[i].md5 + "</p>";
	
	details.innerHTML = newcontent;
    };
    get_thing("shares/" + main_viewmodel.selected_share.path +".json", cb);
}


var on_load = function(){
    update_shares();
    update_content();
}

window.onload = on_load;
</script>  
<body>
  
  <div id="shares">
    <div id="shares_list">
      
    </div>
    <div id="addform">
      <form  action="add_share">
	<table>
	  <tr>
	    <td> Path</td> <td> <input type="directory" name="fname" class="directory"></td>
	  </tr>
	  <tr>
	    <td> Share </td><td><input type="text" name="lname"></td>
	  </tr>
	  <tr><td></td><td><input id="submit" type="submit" value="Add"></td></tr>
	</table>

      </form>
    </div>
  </div>
  <div id="share_details">
    Hello!
  </div>

</body>
</html>
